<div class="d-flex h-100">
  <div class="sidebar border-end" [class.closed]="sidebarOpen">
    @for (page of pages; track page; let idx = $index) {
    <div
      class="thumbnail m-2"
      [class.active]="idx === selectedPageIndex"
      (click)="goToPage(idx)"
    >
      <img [src]="pages[idx]" [alt]="'Page ' + (idx + 1)" class="img-fluid" />
      <p class="text-center">{{ idx + 1 }}</p>
    </div>
    }
  </div>

  <div class="flex-grow-1 position-relative p-0">
    <div class="controls d-flex">
      <div class="d-flex align-items-end flex-column h-50">
        <button class="btn btn-light" (click)="toggleSideBar()">
          <i class="fa-solid fa-bars"></i>
        </button>
        <button class="btn btn-light" (click)="downloadPdf()">
          <i class="fa-solid fa-download"></i>
        </button>
        <button (click)="zoomIn()" class="btn btn-light" type="button">
          <i class="fa-solid fa-magnifying-glass-plus"></i>
        </button>
        <button (click)="zoomOut()" class="btn btn-light" type="button">
          <i class="fa-solid fa-magnifying-glass-minus"></i>
        </button>
        @if(zoomLevel !== 1){
        <div class="text-center fw-bold mt-2">
          {{ zoomLevel * 100 | number : "1.0-0" }}%
        </div>
        }

        <button
          type="button"
          class="btn btn-light mt-auto h-25"
          (click)="prev()"
          [disabled]="displayPageIndex < 1"
        >
          <i class="fa-solid fa-angle-left"></i>
        </button>
      </div>

      <div class="position-relative w-100 align-content-center">
        <div
          class="flipbook-container border"
          #flipbookContainer
          (mousedown)="startDrag($event)"
          (mousemove)="onDrag($event)"
        >
          <div
            class="flipbook"
            [style.transform]="
              'scale(' +
              zoomLevel +
              ') translate(' +
              offsetX +
              'px,' +
              offsetY +
              'px)'
            "
            [style.transformOrigin]="'top left'"
          >
            <div
              class="page left perv"
              [class.hidden]="!pages[displayPageIndex - 3]"
            >
              @if(pages[displayPageIndex - 3]){
              <img
                class="prev"
                [src]="pages[displayPageIndex - 3]"
                alt="Left Page"
              />}
            </div>
            <div
              class="page left current"
              [class.flippingPrev]="isFlippingPrev"
              [class.hidden]="
                !(pages[displayPageIndex - 1] || pages[displayPageIndex - 2])
              "
            >
              @if(!isFlippingPrevHalf){<img
                class="page-current"
                [src]="pages[displayPageIndex - 1]"
                alt="Left Page"
              />} @if(isFlippingPrevHalf){
              <img
                class="page-back-current"
                [src]="pages[displayPageIndex - 2]"
                alt="Left Back Page"
              />}
            </div>
            <div
              class="page right next"
              [class.hidden]="!pages[displayPageIndex + 2]"
            >
              @if(pages[displayPageIndex + 2]){
              <img
                class="next"
                [src]="pages[displayPageIndex + 2]"
                alt="Right Page"
              />}
            </div>
            <div
              class="page right current"
              [class.flippingNext]="isFlippingNext"
              [class.hidden]="
                !(pages[displayPageIndex] || pages[displayPageIndex + 1])
              "
            >
              @if(!isFlippingNextHalf){
              <img
                class="page-current"
                [src]="pages[displayPageIndex]"
                alt="Right Page"
              />} @if(isFlippingNextHalf){
              <img
                class="page-back-current"
                [src]="pages[displayPageIndex + 1]"
                alt="Right Back Page"
              />}
            </div>
          </div>
        </div>
      </div>
      <div class="h-50 d-flex justify-content-end flex-column">
        <button type="button" class="btn btn-light h-25" (click)="next()" [disabled]="this.displayPageIndex >= this.pages.length - 1">
          <i class="fa-solid fa-angle-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<ngx-spinner
  bdColor="rgba(0,0,0,0.7)"
  color="#fff"
  type="ball-scale-multiple"
  [fullScreen]="true"
/>
